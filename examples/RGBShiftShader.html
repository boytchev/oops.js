<!DOCTYPE html>

<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="styles.css">
		<script type="importmap">
		  {
			"imports": {
			  "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
			  "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/",
			  "oops": "../src/oops.js"
			}
		  }
		</script>
	</head>


	<body>
		<script type="module">

			import * as THREE from 'three';

			import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
			import { OrbitControls } from "three/addons/controls/OrbitControls.js";

			import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
			import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
			import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
			import { OutputPass } from 'three/addons/postprocessing/OutputPass.js';

			import { OOPSShader } from 'oops';

			let object;


			var renderer = new THREE.WebGLRenderer( {antialias: true} );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setAnimationLoop( animate );
				document.body.appendChild( renderer.domElement );
				document.body.style = 'margin: 0; overflow: hidden;';

			var camera = new THREE.PerspectiveCamera( 30, innerWidth / innerHeight, 1, 1000 );
				camera.position.z = 400;

			var scene = new THREE.Scene();

			var controls = new OrbitControls( camera, renderer.domElement );
				controls.enableDamping = true;
	
			object = new THREE.Object3D();
			scene.add( object );

			const geometry = new THREE.SphereGeometry( 1, 4, 4 );
			const material = new THREE.MeshPhongMaterial( { color: 0xffffff, flatShading: true } );

			for ( let i = 0; i < 100; i ++ ) {

				const mesh = new THREE.Mesh( geometry, material );
				mesh.position.set( Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5 ).normalize();
				mesh.position.multiplyScalar( Math.random() * 400 );
				mesh.rotation.set( Math.random() * 2, Math.random() * 2, Math.random() * 2 );
				mesh.scale.x = mesh.scale.y = mesh.scale.z = Math.random() * 50;
				object.add( mesh );

			}

			scene.add( new THREE.AmbientLight( 0xcccccc ) );

			const light = new THREE.DirectionalLight( 0xffffff, 3 );
			light.position.set( 1, 1, 1 );
			scene.add( light );

			// postprocessing


			var oops = new OOPSShader( )
					.addShader( 'RGBShiftShader' )
					.addUniform( 'amount', 'amount', 0.02 )
					.addUniform( 'angle', 'angle', 1.57 )
					.addUniform( 'opacity', 'opacity', 1 );
					
			var effect = new ShaderPass( oops );

			var composer = new EffectComposer( renderer );
				composer.addPass( new RenderPass( scene, camera ) );
				composer.addPass( effect );
				composer.addPass( new OutputPass() );

			window.addEventListener( 'resize', onWindowResize );

			function onWindowResize()
			{
				camera.aspect = innerWidth / innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( innerWidth, innerHeight );
				composer.setSize( innerWidth, innerHeight );
			}


			var gui = new GUI( { title: '<big><em>RGB Shift Shader</em> settings</big>' } );
			//var gui = new GUI( { title: '<big><em>RGB SHIFT SHADER</em> settings</big>' } );
				gui.add( effect.uniforms[ 'amount' ], 'value', 0, 0.04 ).step( 0.001 ).name( 'Amount' );//.$input.classList.add('top');
				gui.add( effect.uniforms[ 'angle' ], 'value', 0, 6.28 ).step( 0.01 ).name( 'Angle' );
				gui.add( effect.uniforms[ 'opacity' ], 'value', 0, 1 ).step( 0.01 ).name( 'Opacity' ).$input.classList.add('bottom');
//a.$input.classList.add('top');
//b.$input.classList.add('bottom');

			function animate( t ) {

				controls?.update( );
				//object.rotation.x += 0.0005;
				//object.rotation.y += 0.001;
				light.position.copy( camera.position );
				composer.render();

			}

		</script>

	</body>
</html>


